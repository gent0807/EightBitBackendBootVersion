<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardMyBatisDAO">



    <select id="getBoardList" resultType="board">
        select a.* from (select row_number() over(order by b.seq desc) AS id, b.* from (select * from
                                                                                                     board article left join user member
                                                                                                         on article.writer=member.nickname
                                                                                                            order by seq desc) b ) a
    </select>

    <select id="getUserArticles" resultType="board">
        select a.* from (select row_number() over(order by b.seq desc) AS id, b.* from (select * from board order by seq desc) b ) a where writer=#{writer}
    </select>

    <select id="getArticleReplies" resultType="reply">
        select a.* from (select row_number() over(order by b.seq) AS id, b.* from (select * from freeReply where original_writer=#{original_writer} and original_regdate=#{original_regdate} order by seq) b) a
    </select>

    <select id="getReplyReComments" resultType="reComment">
        select a.* from (select row_number() over(order by b.seq) AS id, b.* from (select * from freeReComment where original_replyer=#{original_replyer} and original_regdate=#{original_regdate} order by seq) b) a
    </select>

    <select id="getArticle" resultType="board">
        select * from board where writer=#{writer} and regdate=#{regdate}
    </select>

    <select id="getAttachList" resultType="uploadFile">
        select * from freeArticleFileShare where uploader=#{uploader} and regdate=#{regdate}
    </select>

    <select id="getAttachFile" resultType="uploadFile">
        select * from freeArticleFileShare where id=#{id} and uploader=#{uploader} and regdate=#{regdate}
    </select>

    <select id="getViewFile" resultType="uploadFile">
        select * from freeArticleFileView where id=#{id} and uploader=#{uploader} and regdate=#{regdate}
    </select>

    <select id="getReply" resultType="reply">
        select * from freeReply where replyer=#{replyer} and regdate=#{regdate}
    </select>

    <select id="getReComment" resultType="reComment">
        select * from freeReComment where reCommenter=#{reCommenter} and regdate=#{regdate}
    </select>

    <select id="getArticleView" resultType="_int">
        select count(*) from freeArticleView where viewer=#{viewer} and writer=#{writer} and regdate=#{regdate}
    </select>

    <select id="getArticleLikers" resultType="string">
        select liker from freeArticleLike where writer=#{writer} and regdate=#{regdate}
    </select>

    <select id="getReplyLikers" resultType="string">
        select liker from freeReplyLike where replyer=#{replyer} and regdate=#{regdate}
    </select>

    <select id="getReCommentLikers" resultType="string">
        select liker from freeReCommentLike where reCommenter=#{reCommenter} and regdate=#{regdate}
    </select>

    <select id="getReCommentCount" resultType="_int">
        select count(*) from freeReComment A
            left join freeReply B on A.original_replyer=B.replyer and A.original_regdate=B.regdate
                left join board C on B.original_writer=C.writer and B.original_regdate=C.regdate
                    where writer=#{writer} and C.regdate=#{regdate}
    </select>

    <select id="selectSeqOfWriter" resultType="board">
        select max(a.seq) as seq from (select seq from board where writer=#{writer}) as a;
    </select>

    <select id="getSeqOfReply" resultType="_int">
        select max(a.seq) as seq from (select seq from freeReply where replyer=#{replyer}) as a;
    </select>

    <select id="getSeqOfReComment" resultType="_int">
        select max(a.seq) as seq from (select seq from freeReComment where reCommenter=#{reCommenter}) as a;
    </select>

    <select id="findWriterAndRegdate" resultType="board">
        select writer, regdate from board where seq=#{seq}
    </select>

    <select id="getReplyRegdateAndUpdatedate" resultType="reply">
        select regdate, updatedate from freeReply where seq=#{seq}
    </select>

    <select id="getReCommentRegdateAndUpdatedate" resultType="reComment">
        select regdate, updatedate from freeReComment where seq=#{seq}
    </select>

    <select id="selectLikeOfArticle" resultType="board">
        select likecount from board where writer=#{writer} and regdate=#{regdate}
    </select>

    <insert id="insertArticle">
        insert into board(title, writer, content) values(#{title}, #{writer}, #{content})
    </insert>

    <insert id="insertReply">
        insert into freeReply(original_writer, original_regdate, replyer, content) values (#{original_writer}, #{original_regdate}, #{replyer}, #{content})
    </insert>

    <insert id="insertReComment">
        insert into freeReComment(original_replyer, original_regdate, reCommenter, content) values (#{original_replyer}, #{original_regdate}, #{reCommenter}, #{content})
    </insert>

    <insert id="insertArticleView">
        insert into freeArticleView(viewer, writer, regdate) values(#{viewer},#{writer},#{regdate})
    </insert>

    <insert id="insertArticleLike">
        insert into freeArticleLike values (#{liker},#{writer},#{regdate})
    </insert>

    <insert id="insertReplyLike">
        insert into freeReplyLike values (#{liker},#{replyer},#{regdate})
    </insert>

    <insert id="insertReCommentLike">
        insert into freeReCommentLike values (#{liker},#{reCommenter},#{regdate})
    </insert>

    <insert id="insertArticleShareFile">
        insert into freeArticleFileShare(uploader, regdate, storeFilename, uploadFilename) values(#{uploader}, #{regdate}, #{storeFilename}, #{uploadFilename})
    </insert>

    <insert id="insertArticleViewFile">
        insert into freeArticleViewFile(uploader, regdate, storeFilename, uploadFilename) values(#{uploader}, #{regdate}, #{storeFilename},#{uploadFilename})
    </insert>

    <update id="updateArticle">
        update board set title=#{title}, content=#{content}, updatedate=now() where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="updateReply">
        update freeReply set content=#{content}, updatedate=now() where replyer=#{replyer} and regdate=#{regdate}
    </update>

    <update id="updateReComment">
        update freeReComment set content=#{content}, updatedate=now() where reCommenter=#{reCommenter} and regdate=#{regdate}
    </update>

    <update id="updateArticleVisitCnt">
        update board set visitcnt=visitcnt+1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="updateAbuseArticle">
        update board set abuse_report=abuse_report+1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="update19Article">
        update board set 19report=19report+1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="updateIncoporateArticle">
        update board set incoporate_report=incoporate_report+1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="updateAbuseReply">
        update freeReply set abuse_report=abuse_report+1 where replyer=#{replyer} and regdate=#{regdate}
    </update>

    <update id="update19Reply">
        update freeReply set 19report=19report+1 where replyer=#{replyer} and regdate=#{regdate}
    </update>

    <update id="updateIncoporateReply">
        update freeReply set incoporate_report=incoporate_report+1 where replyer=#{replyer} and regdate=#{regdate}
    </update>

    <update id="updateAbuseReComment">
        update freeReComment set abuse_report=abuse_report+1 where reCommenter=#{reCommenter} and regdate=#{regdate}
    </update>

    <update id="update19ReComment">
        update freeReComment set 19report=19report+1 where reCommenter=#{reCommenter} and regdate=#{regdate}
    </update>

    <update id="updateIncoporateReComment">
        update freeReComment set incoporate_report=incoporate_report+1 where reCommenter=#{reCommenter} and regdate=#{regdate}
    </update>

    <update id="updateArticleView">
        update freeArticleView set viewdate=now() where viewer=#{viewer} and writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="countUpArticleLike">
        update board set likecount=likecount+1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <update id="countDownArticleLike">
        update board set likecount=likecount-1 where writer=#{writer} and regdate=#{regdate}
    </update>

    <delete id="deleteArticle">
        delete from board where writer=#{writer} and regdate=#{regdate}
    </delete>

    <delete id="deleteArticleShareFile">
        delete from freeArticleFileShare where id=#{id} and uploader=#{uploader} and regdate=#{regdate}
    </delete>

    <delete id="deleteReply">
        delete from freeReply where replyer=#{replyer} and regdate=#{regdate}
    </delete>

    <delete id="deleteReComment">
        delete from freeReComment where reCommenter=#{reCommenter} and regdate=#{regdate}
    </delete>

    <delete id="deleteArticleLike">
        delete from freeArticleLike where liker=#{liker} and writer=#{writer} and regdate=#{regdate}
    </delete>

    <delete id="deleteReplyLike">
        delete from freeReplyLike where liker=#{liker} and replyer=#{replyer} and regdate=#{regdate}
    </delete>

    <delete id="deleteReCommentLike">
        delete from freeReCommentLike where liker=#{liker} and reCommenter=#{reCommenter} and regdate=#{regdate}
    </delete>
</mapper>